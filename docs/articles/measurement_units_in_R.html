<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Measurement units in R • units</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">units</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edzer/units/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Measurement units in R</h1>
                        <h4 class="author">Edzer Pebesma, Thomas Mailund, and James Hiebert</h4>
            
          </div>

    
    
<div class="contents">
<p>This vignette is identical to <span class="citation">E. Pebesma, Mailund, and Hiebert (2016)</span>, except for two changes:</p>
<ul>
<li>it has been synchronized with updates to the <a href="https://cran.r-project.org/package=units">units</a> package</li>
<li>it has been converted to R-markdown</li>
</ul>
<div id="abstract" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#abstract" class="anchor"> </a></body></html>Abstract</h2>
<p>We briefly review SI units, and discuss R packages that deal with measurement units, their compatibility and conversion. Built upon <a href="https://cran.r-project.org/package=udunits2">udunits2</a> and the UNIDATA udunits library, we introduce the package <a href="https://cran.r-project.org/package=units">units</a> that provides a class for maintaining unit metadata. When used in expression, it automatically converts units, and simplifies units of results when possible; in case of incompatible units, errors are raised. The class flexibly allows expansion beyond predefined units. Using <a href="https://cran.r-project.org/package=units">units</a> may eliminate a whole class of potential scientific programming mistakes. We discuss the potential and limitations of computing with explicit units.</p>
</div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#introduction" class="anchor"> </a></body></html>Introduction</h2>
<p>Two quotes from <span class="citation">Cobb and Moore (1997)</span> – <em>Data are not just numbers, they are numbers with a context</em> and <em>in data analysis, context provides meaning</em> – illustrate that for a data analysis to be meaningful, knowledge of the data’s context is needed. Pragmatic aspects of this context include who collected or generated the data, how this was done, and for which purpose <span class="citation">(Scheider et al. 2016)</span>; semantic aspects concern what the data represents: which aspect of the world do the data refer to, when and where were they measured, and what a value of <code>1</code> means.</p>
<p>R does allow for keeping some context with data, for instance</p>
<ul>
<li>
<code>data.frame</code> columns must have and <code>list</code> elements may have names that can be used to describe context, using freetext</li>
<li>
<code>matrix</code> or <code>array</code> objects may have <code>dimnames</code>
</li>
<li>for variables of class <code>factor</code> or <code>ordered</code>, <code>levels</code> may indicate, using freetext, the categories of nominal or ordinal variables</li>
<li>
<code>POSIXt</code> and <code>Date</code> objects specify how numbers should be interpreted as time or date, with fixed units (second and day, respectively) and origin (Jan 1, 1970, 00:00 UTC)</li>
<li>
<code>difftime</code> objects specify how time duration can be represented by numbers, with flexible units (secs, mins, hours, days, weeks); <a href="https://cran.r-project.org/package=lubridate">lubridate</a> <span class="citation">(Grolemund and Wickham 2011)</span> extends some of this functionality.</li>
</ul>
<p>Furthermore, if spatial objects as defined in package <a href="https://cran.r-project.org/package=sp">sp</a> <span class="citation">(E. Pebesma and Bivand 2005)</span> have a proper coordinate reference system set, they can be transformed to other datums, or converted to various flat (projected) representations of the Earth <span class="citation">(Iliffe and Lott 2008)</span>.</p>
<p>In many cases however, R drops contextual information. As an example, we look at annual global land-ocean temperature index (from <a href="http://climate.nasa.gov/vital-signs/global-temperature/" class="uri">http://climate.nasa.gov/vital-signs/global-temperature/</a> ) since 1960:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp_data =<span class="st"> </span><span class="kw">subset</span>(<span class="kw">read.table</span>(<span class="st">"647_Global_Temperature_Data_File.txt"</span>, 
    <span class="dt">header=</span><span class="ot">TRUE</span>)[<span class="dv">1</span>:<span class="dv">2</span>], Year &gt;=<span class="st"> </span><span class="dv">1960</span>)
temp_data$date =<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">paste0</span>(temp_data$Year, <span class="st">"-01-01"</span>))
temp_data$time =<span class="st"> </span><span class="kw">as.POSIXct</span>(temp_data$date)
<span class="kw">Sys.setenv</span>(<span class="dt">TZ=</span><span class="st">"UTC"</span>)
<span class="kw">head</span>(temp_data, <span class="dv">3</span>)
##    Year Annual_Mean       date       time
## 81 1960       -0.03 1960-01-01 1960-01-01
## 82 1961        0.05 1961-01-01 1961-01-01
## 83 1962        0.02 1962-01-01 1962-01-01
year_duration =<span class="st"> </span><span class="kw">diff</span>(temp_data$date)
<span class="kw">mean</span>(year_duration)
## Time difference of 365.2545 days</code></pre></div>
<p>Here, the time difference units are reported for the <code>difftime</code> object <code>year_duration</code>, but if we would use it in a linear algebra operation</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">year_duration %*%<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">length</span>(year_duration)) /<span class="st"> </span><span class="kw">length</span>(year_duration)
##          [,1]
## [1,] 365.2545</code></pre></div>
<p>the unit is dropped. Similarly, for linear regression coefficients we see</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(<span class="kw">lm</span>(Annual_Mean ~<span class="st"> </span>date, temp_data))
##  (Intercept)         date 
## 1.833671e-02 4.364763e-05
<span class="kw">coef</span>(<span class="kw">lm</span>(Annual_Mean ~<span class="st"> </span>time, temp_data))
##  (Intercept)         time 
## 1.833671e-02 5.051809e-10</code></pre></div>
<p>where the unit of change is in degrees Celsius but either <em>per day</em> (<code>date</code>) or <em>per second</em> (<code>time</code>). For purely mathematical manipulations, R often strips context from numbers when it is carried in attributes, the linear algebra routines being a prime example.</p>
<p>Most variables are somehow attributed with information about their <em>units</em>, which specify what the value <code>1</code> of this variable represents. This may be counts of something, e.g. <code>1 apple</code>, but it may also refer to some <em>physical unit</em>, such as distance in meter. This article discusses how strong unit support can be introduced in R.</p>
</div>
<div id="si" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#si" class="anchor"> </a></body></html>SI</h2>
<p>The <a href="http://www.bipm.org/">BIPM</a> (Bureau International des Poids et Mesures) is the “<em>the intergovernmental organization through which Member States act together on matters related to measurement science and measurement standards. Its recommended practical system of units of measurement is the International System of Units (Syst`{e}me International d’Unit'{e}s, with the international abbreviation SI)</em> (<a href="http://www.bipm.org/en/measurement-units/" class="uri">http://www.bipm.org/en/measurement-units/</a>)”.</p>
<p><span class="citation">International Bureau of Weights and Measures, Taylor, and Thompson (2001)</span> describe the SI units, where, briefly, <em>SI units</em></p>
<ul>
<li>consist of seven base units (length, mass, time &amp; duration, electric current, thermodynamic temperature, amount of substance, and luminous intensity), each with a name and abbreviation (see table below)</li>
<li>consist of <em>derived units</em> that are formed by products of powers of base units, such as m/s<span class="math inline">\(^2\)</span>, many of which have special names and symbols (e.g. angle: 1 rad = 1 m/m; force: 1 N = 1 m kg s<span class="math inline">\(^{-2}\)</span>)</li>
<li>consist of <em>coherent derived units</em> when derived units include no numerical factors other than one (with the exception of <code>kg</code>; as a base unit, kg can be part of coherent derived units); an example of a coherent derived unit is 1 watt = 1 joule per 1 second,</li>
<li>may contain SI prefixes (k = kilo for <span class="math inline">\(10^3\)</span>, m = milli for <span class="math inline">\(10^{-3}\)</span>, etc.)</li>
<li>contain special quantities where units disappear (e.g., m/m) or have the nature of a count, in which cases the unit is 1.</li>
</ul>
<p>base quantities, SI units and their symbols (from <span class="citation">International Bureau of Weights and Measures, Taylor, and Thompson (2001)</span>, p. 23):</p>
<table class="table">
<thead><tr class="header">
<th align="left">Base quantity</th>
<th align="left"></th>
<th align="left">SI base unit</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Symbol</td>
<td align="left">Name</td>
<td align="left">Symbol</td>
</tr>
<tr class="even">
<td align="left">length</td>
<td align="left">
<span class="math inline">\(l,x,r,\)</span> etc.</td>
<td align="left">meter</td>
<td align="left">m</td>
</tr>
<tr class="odd">
<td align="left">mass</td>
<td align="left"><span class="math inline">\(m\)</span></td>
<td align="left">kilogram</td>
<td align="left">kg</td>
</tr>
<tr class="even">
<td align="left">time, duration</td>
<td align="left"><span class="math inline">\(t\)</span></td>
<td align="left">second</td>
<td align="left">s</td>
</tr>
<tr class="odd">
<td align="left">electric current</td>
<td align="left"><span class="math inline">\(I, i\)</span></td>
<td align="left">ampere</td>
<td align="left">A</td>
</tr>
<tr class="even">
<td align="left">thermodynamic temperature</td>
<td align="left"><span class="math inline">\(T\)</span></td>
<td align="left">kelvin</td>
<td align="left">K</td>
</tr>
<tr class="odd">
<td align="left">amount of substance</td>
<td align="left"><span class="math inline">\(n\)</span></td>
<td align="left">mole</td>
<td align="left">mol</td>
</tr>
<tr class="even">
<td align="left">luminous intensity</td>
<td align="left"><span class="math inline">\(I_v\)</span></td>
<td align="left">candela</td>
<td align="left">cd</td>
</tr>
</tbody>
</table>
</div>
<div id="related-work-in-r" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#related-work-in-r" class="anchor"> </a></body></html>Related work in R</h2>
<p>Several R packages provide unit conversions. For instance, <a href="https://cran.r-project.org/package=measurements">measurements</a> <span class="citation">(Birk 2016)</span> provides a collection of tools to make working with physical measurements easier. It converts between metric and imperial units, or calculates a dimension’s unknown value from other dimensions’ measurements. It does this by the <code>conv_unit</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(measurements)
<span class="kw">conv_unit</span>(<span class="fl">2.54</span>, <span class="st">"cm"</span>, <span class="st">"inch"</span>)
## [1] 1
<span class="kw">conv_unit</span>(<span class="kw">c</span>(<span class="st">"101 44.32"</span>,<span class="st">"3 19.453"</span>), <span class="st">"deg_dec_min"</span>, <span class="st">"deg_min_sec"</span>)
## [1] "101 44 19.2000000000116" "3 19 27.1800000000003"
<span class="kw">conv_unit</span>(<span class="dv">10</span>, <span class="st">"cm_per_sec"</span>, <span class="st">"km_per_day"</span>)
## [1] 8.64</code></pre></div>
<p>but uses for instance <code>kph</code> instead of <code>km_per_hour</code>, and then <code>m3_per_hr</code> for flow – unit names seem to come from convention rather than systematic composition. Object <code>conv_unit_options</code> contains all 173 supported units, categorized by the physical dimension they describe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(conv_unit_options)
##  [1] "acceleration" "angle"        "area"         "coordinate"  
##  [5] "count"        "duration"     "energy"       "flow"        
##  [9] "length"       "mass"         "power"        "pressure"    
## [13] "speed"        "temperature"  "volume"
conv_unit_options$volume
##  [1] "ul"        "ml"        "dl"        "l"         "cm3"      
##  [6] "dm3"       "m3"        "km3"       "us_tsp"    "us_tbsp"  
## [11] "us_oz"     "us_cup"    "us_pint"   "us_quart"  "us_gal"   
## [16] "inch3"     "ft3"       "mi3"       "imp_tsp"   "imp_tbsp" 
## [21] "imp_oz"    "imp_cup"   "imp_pint"  "imp_quart" "imp_gal"</code></pre></div>
<p>Function <code>conv_dim</code> allows for the conversion of units in products or ratios, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">conv_dim</span>(<span class="dt">x =</span> <span class="dv">100</span>, <span class="dt">x_unit =</span> <span class="st">"m"</span>, <span class="dt">trans =</span> <span class="dv">3</span>, <span class="dt">trans_unit =</span> <span class="st">"ft_per_sec"</span>, <span class="dt">y_unit =</span> <span class="st">"min"</span>)
## [1] 1.822689</code></pre></div>
<p>computes how many minutes it takes to travel 100 meters at 3 feet per second.</p>
<p>Package <a href="https://cran.r-project.org/package=NISTunits">NISTunits</a> <span class="citation">(Gama 2014)</span> provides fundamental physical constants (Quantity, Value, Uncertainty, Unit) for SI and non-SI units, plus unit conversions, based on the data from NIST (National Institute of Standards and Technology). The package provides a single function for every unit conversion; all but 5 from its 896 functions are of the form <code>NISTxxxTOyyy</code> where <code>xxx</code> and <code>yyy</code> refer to two different units. For instance, converting from W m<span class="math inline">\(^{-2}\)</span> to W inch<span class="math inline">\(^{-2}\)</span> is done by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(NISTunits)
<span class="kw">NISTwattPerSqrMeterTOwattPerSqrInch</span>(<span class="dv">1</span>:<span class="dv">5</span>)
## [1] 0.00064516 0.00129032 0.00193548 0.00258064 0.00322580</code></pre></div>
<p>Both <a href="https://cran.r-project.org/package=measurements">measurements</a> and <a href="https://cran.r-project.org/package=NISTunits">NISTunits</a> are written entirely in R.</p>
</div>
<div id="unidatas-udunits-library-and-the-udunits2-r-package" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#unidatas-udunits-library-and-the-udunits2-r-package" class="anchor"> </a></body></html>UNIDATA’s udunits library and the <code>udunits2</code> R package</h2>
<p>Udunits, developed by UCAR/UNIDATA, advertises itself on <a href="https://www.unidata.ucar.edu/software/udunits/">its web page</a> as: “<em>The udunits package supports units of physical quantities. Its C library provides for arithmetic manipulation of units and for conversion of numeric values between compatible units. The package contains an extensive unit database, which is in XML format and user-extendable.</em>”</p>
<p>The R package <a href="https://cran.r-project.org/package=udunits2">udunits2</a> <span class="citation">(Hiebert 2015)</span> provides an R level interface to the most important functions in the C library.</p>
<p>The functions provided by <a href="https://cran.r-project.org/package=udunits2">udunits2</a> are</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(udunits2)
## udunits system database read from /usr/local/share/udunits/udunits2.xml
<span class="kw">ls</span>(<span class="dv">2</span>)
## [1] "ud.are.convertible"  "ud.convert"          "ud.get.name"        
## [4] "ud.get.symbol"       "ud.have.unit.system" "ud.is.parseable"    
## [7] "ud.set.encoding"</code></pre></div>
<p>Dropping the <code>ud</code> prefix, <code>is.parseable</code> verifies whether a unit is parseable</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ud.is.parseable</span>(<span class="st">"m/s"</span>)
## [1] TRUE
<span class="kw">ud.is.parseable</span>(<span class="st">"q"</span>)
## [1] FALSE</code></pre></div>
<p><code>are.convertible</code> specifies whether two units are convertible</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ud.are.convertible</span>(<span class="st">"m/s"</span>, <span class="st">"km/h"</span>)
## [1] TRUE
<span class="kw">ud.are.convertible</span>(<span class="st">"m/s"</span>, <span class="st">"s"</span>)
## [1] FALSE</code></pre></div>
<p><code>convert</code> converts units that are convertible, and throws an error otherwise</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ud.convert</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="st">"m/s"</span>, <span class="st">"km/h"</span>)
## [1]  3.6  7.2 10.8</code></pre></div>
<p>and <code>get.name</code>, <code>get.symbol</code> and <code>set.encoding</code> get name, get symbol or modify encoding of the character unit arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ud.get.name</span>(<span class="st">"kg"</span>)
## [1] "kilogram"
<span class="kw">ud.get.symbol</span>(<span class="st">"kilogram"</span>)
## [1] "kg"
<span class="kw">ud.set.encoding</span>(<span class="st">"utf8"</span>)
## NULL</code></pre></div>
<p>Unlike the <a href="https://cran.r-project.org/package=measurements">measurements</a> and <a href="https://cran.r-project.org/package=NISTunits">NISTunits</a>, <a href="https://cran.r-project.org/package=udunits2">udunits2</a> parses units as expressions, and bases its logic upon the convertibility of expressions, rather than the comparison of fixed strings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m100_a =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">"m"</span>, <span class="dv">100</span>), <span class="dt">collapse =</span> <span class="st">"*"</span>)
dm100_b =<span class="st"> "dm^100"</span>
<span class="kw">ud.is.parseable</span>(m100_a)
## [1] TRUE
<span class="kw">ud.is.parseable</span>(dm100_b)
## [1] TRUE
<span class="kw">ud.are.convertible</span>(m100_a, dm100_b)
## [1] TRUE</code></pre></div>
<p>This has the advantage that through complex computations, intermediate objects can have units that are arbitrarily complex, and that can potentially be simplified later on. It also means that the package practically supports an unlimited amount of derived units.</p>
</div>
<div id="udunits-versus-the-unified-code-for-units-of-measure-ucum" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#udunits-versus-the-unified-code-for-units-of-measure-ucum" class="anchor"> </a></body></html>Udunits versus the Unified Code for Units of Measure (UCUM)</h2>
<p>Another set of encodings for measurement units is the Unified Code for Units of Measure (UCUM, <span class="citation">Schadow and McDonald (2009)</span>). A dedicated web site describes the details of the differences between udunits and UCUM, and provides a conversion service between the two encoding sets.</p>
<p>The UCUM website refers to some Java implementations, but some of the links seem to be dead. UCUM is the preferred encoding for standards from the Open Geospatial Consortium. udunits on the other hand is the units standard of choice by the climate science community, and is adopted by the CF (Climate and Forecast) conventions, which mostly uses NetCDF. NetCDF <span class="citation">(Rew and Davis 1990)</span> is a binary data format that is widely used for atmospheric and climate model predictions.</p>
<p>The udunits library is a C library that has strong support from UNIDATA, and we decided to build our developments on this, rather than on Java implementations of UCUM with a less clear provenance.</p>
</div>
<div id="handling-data-with-units-in-r-the-units-package" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#handling-data-with-units-in-r-the-units-package" class="anchor"> </a></body></html>Handling data with units in R: the units package</h2>
<p>The <a href="https://cran.r-project.org/package=units">units</a> package builds <code>units</code> objects from scratch, where <code>m</code>, created by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(units)
m =<span class="st"> </span><span class="kw"><a href="../reference/make_unit.html">make_unit</a></span>(<span class="st">"m"</span>)
<span class="kw">str</span>(m)
## Class 'units'  atomic [1:1] 1
##   ..- attr(*, "units")=List of 2
##   .. ..$ numerator  : chr "m"
##   .. ..$ denominator: chr(0) 
##   .. ..- attr(*, "class")= chr "symbolic_units"</code></pre></div>
<p>represents <code>1 m</code>, one meter. Other length values are obtained by using this unit in an expression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x1 =<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span> *<span class="st"> </span>m</code></pre></div>
<p>As an alternative to using <code>make_unit</code>, we can retrieve units directly from the <code>ud_units</code> database, which is part of <a href="https://cran.r-project.org/package=units">units</a>, and was derived from the xml units database that is part of udunits. Two ways of doing this are</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x2 =<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span> *<span class="st"> </span>ud_units$m
<span class="kw">identical</span>(x1, x2)
## [1] TRUE
x3 =<span class="st"> </span><span class="dv">1</span>:<span class="dv">5</span> *<span class="st"> </span><span class="kw">with</span>(ud_units, m)
<span class="kw">identical</span>(x1, x3)
## [1] TRUE</code></pre></div>
<p>Although one could attach <code>ud_units</code> to use the units directly, there are over 3000 and this would not only clobber the namespace but also lead to conflicts, e.g. for <code>T</code> (Tesla, <code>TRUE</code>) or <code>in</code> (inch, reserved R language element). The last form using <code>with</code> has the advantage that it can take direct expressions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(ud_units, m/s^<span class="dv">2</span>)
## 1 m/s^2</code></pre></div>
<p>A convenience function that directly evaluates a units expression in the environment <code>ud_units</code>, thus avoiding <code>with</code>, is <code>set_units</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>:<span class="dv">5</span>, cm)
## Units: cm
## [1] 1 2 3 4 5
<span class="kw">library</span>(magrittr)
<span class="dv">1</span>:<span class="dv">5</span> %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(N/s)
## Units: N/s
## [1] 1 2 3 4 5</code></pre></div>
<p>Several manipulations with <code>units</code> objects will now be illustrated.</p>
<p>Manipulations that do not involve unit conversion are for instance addition:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>:<span class="dv">3</span>, m/s)
x +<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span>x
## Units: m/s
## [1] 3 6 9</code></pre></div>
<p>Explicit unit conversion is done by assigning new units:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">x =</span> <span class="kw"><a href="../reference/units.html">set_units</a></span>(x, cm/s))
## Units: cm/s
## [1] 100 200 300
<span class="kw">as.numeric</span>(x)
## [1] 100 200 300</code></pre></div>
<p>similar to the behaviour of <code>difftime</code> objects, this modifies the numeric values without modifying their meaning (what the numbers refer to).</p>
<p>When mixing units in sums, comparisons or concatenation, units are automatically converted to those of the first argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>:<span class="dv">3</span>, km/h)
x +<span class="st"> </span>y
## Units: cm/s
## [1] 127.7778 255.5556 383.3333
y +<span class="st"> </span>x
## Units: km/h
## [1]  4.6  9.2 13.8
x ==<span class="st"> </span>y
## [1] FALSE FALSE FALSE
<span class="kw">c</span>(y, x)
## Units: km/h
## [1]  1.0  2.0  3.0  3.6  7.2 10.8</code></pre></div>
<p>where <code>c(y, x)</code> concatenates <code>y</code> and <code>x</code> after converting <code>x</code> to the units of <code>y</code>. Derived units are created where appropriate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x *<span class="st"> </span>y
## Units: cm*km/h/s
## [1] 100 400 900
x^<span class="dv">3</span>
## Units: cm^3/s^3
## [1] 1.0e+06 8.0e+06 2.7e+07</code></pre></div>
<p>and meaningful error messages appear when units are not compatible:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">e =<span class="st"> </span><span class="kw">try</span>(z &lt;-<span class="st"> </span>x +<span class="st"> </span>x *<span class="st"> </span>y)
<span class="kw">attr</span>(e, <span class="st">"condition"</span>)[[<span class="dv">1</span>]]
## [1] "cannot convert cm*km/h/s into cm/s"</code></pre></div>
<p>The full set of methods and method groups for <code>units</code> objects is shown by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(<span class="dt">class =</span> <span class="st">"units"</span>)
##  [1] as.data.frame c             diff          format        hist         
##  [6] Math          mean          median        Ops           plot         
## [11] print         quantile      set_units     summary       Summary      
## [16] [             units&lt;-       units         weighted.mean
## see '?methods' for accessing help and source code</code></pre></div>
<p>where the method groups</p>
<ul>
<li>
<code>Ops</code> include operations that require compatible units, converting when necessary (<code>+</code>, <code>-</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>), and operations that create new units (<code>*</code>, <code>/</code>, <code>^</code> and <code>**</code>),</li>
<li>
<code>Math</code> include <code>abs</code>, <code>sign</code>, <code>floor</code>, <code>ceiling</code>, <code>trunc</code>, <code>round</code>, <code>signif</code>, <code>log</code>, <code>cumsum</code>, <code>cummax</code>, <code>cummin</code>, and</li>
<li>
<code>Summary</code> include <code>sum</code>, <code>min</code>, <code>max</code> and <code>range</code>, and all convert to the unit of the first argument.</li>
</ul>
<p>When possible, new units are simplified:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>:<span class="dv">10</span>, m/s)
b =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>:<span class="dv">10</span>, h)
a *<span class="st"> </span>b
## Units: m
##  [1]   3600  14400  32400  57600  90000 129600 176400 230400 291600 360000
<span class="kw"><a href="../reference/make_unit.html">make_unit</a></span>(m100_a) /<span class="st"> </span><span class="kw"><a href="../reference/make_unit.html">make_unit</a></span>(dm100_b)
## 1e+100 1</code></pre></div>
<p>Units are printed as simple R expressions, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>, m^<span class="dv">5</span>/s^<span class="dv">4</span>)
## 1 m^5/s^4</code></pre></div>
<p>Another way to print units commonly seen in Climate and Forecast Conventions is <code>m2 s-1</code> for m<span class="math inline">\(^2\)</span>/s. These are not R expressions, but as they are understood by udunits, they can be converted (by udunits) but not simplified (by R):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw"><a href="../reference/make_unit.html">make_unit</a></span>(<span class="st">"m2 s-1"</span>)
y =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>, km^<span class="dv">2</span>/h)
z =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>, m^<span class="dv">2</span>/s)
x +<span class="st"> </span>y
## 278.7778 (m2 s-1)
x/y
## 1 h*(m2 s-1)/km^2
z/y
## 0.0036 1</code></pre></div>
<p>However, <code>parse_unit</code> parses such units, and <code>as_cf</code> returns such unit strings from <code>units</code> objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/parse_unit.html">parse_unit</a></span>(<span class="st">"m2 s-1"</span>)
## 1 m^2/s
<span class="kw"><a href="../reference/as_cf.html">as_cf</a></span>(<span class="kw"><a href="../reference/units.html">set_units</a></span>(<span class="dv">1</span>, m^<span class="dv">2</span>*s^-<span class="dv">1</span>))
## [1] "m2 s-1"</code></pre></div>
<p>The <code>plot</code> and <code>hist</code> methods add units to default axis labels, an example is shown in the following figures. For <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plots <span class="citation">(Wickham 2009)</span>, automatic unit placement in default axis label is provided by package <a href="https://cran.r-project.org/package=ggforce">ggforce</a> <span class="citation">(Pedersen 2016)</span>; <code>demo(ggforce)</code> gives an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(units)
<span class="kw"><a href="../reference/units_options.html">units_options</a></span>(<span class="dt">negative_power =</span> <span class="ot">TRUE</span>)
gallon =<span class="st"> </span><span class="kw"><a href="../reference/make_unit.html">make_unit</a></span>(<span class="st">"gallon"</span>)
<span class="co"># initialize units:</span>
mtcars$consumption =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(mtcars$mpg, mi/gallon)
<span class="co"># "in" is also a reserved R keyword, and needs special treatment:</span>
mtcars$displacement =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(mtcars$disp, ud_units[[<span class="st">"in"</span>]]^<span class="dv">3</span>)
<span class="co"># convert to SI:</span>
mtcars$consumption =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(mtcars$consumption, km/l)
mtcars$displacement =<span class="st"> </span><span class="kw"><a href="../reference/units.html">set_units</a></span>(mtcars$displacement, cm^<span class="dv">3</span>)
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">par</span>(<span class="st">"mar"</span>) +<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>))
<span class="kw">with</span>(mtcars, <span class="kw">plot</span>(<span class="dv">1</span>/displacement, <span class="dv">1</span>/consumption))</code></pre></div>
<p><img src="measurement_units_in_R_files/figure-html/unnamed-chunk-30-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggforce)
## Loading required package: ggplot2
<span class="kw">ggplot</span>(mtcars) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dv">1</span>/displacement, <span class="dv">1</span>/consumption))</code></pre></div>
<p><img src="measurement_units_in_R_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
<p>Automatic conversion between <code>units</code> and <code>difftime</code> is provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">dt =</span> <span class="kw">diff</span>(<span class="kw">Sys.time</span>() +<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1+60</span>, <span class="dv">1+60+3600</span>))) <span class="co"># class difftime</span>
## Time differences in secs
## [1]    1   60 3600
(<span class="dt">dt.u =</span> <span class="kw"><a href="../reference/as.units.html">as.units</a></span>(dt))
## Units: s
## [1]    1   60 3600
<span class="kw">identical</span>(<span class="kw"><a href="../reference/as.dt.html">as.dt</a></span>(dt.u), dt) <span class="co"># as.difftime is not a generic</span>
## [1] TRUE</code></pre></div>
<p>Objects of class <code>units</code> can be used as columns in <code>data.frame</code> objects, as well as in <code>tbl_df</code> <span class="citation">(Wickham, Francois, and Müller 2016)</span>.</p>
</div>
<div id="discussion-and-conclusions" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#discussion-and-conclusions" class="anchor"> </a></body></html>Discussion and conclusions</h2>
<p>The <a href="https://cran.r-project.org/package=units">units</a> R package provides a new class, <code>units</code>, for numeric data with associated measurement units. Operations on objects of this class retain the unit metadata and provide automated dimensional analysis: dimensions are taken into consideration in computations and comparisons. Combining different units that are compatible triggers automatic unit conversion, derived units are automatically generated and simplified where possible, and meaningful error messages are given when a user tries to add objects with incompatible units. This verifies that computations are not only syntactically and numerically allowed, but also semantically, and in the case of physical units, physically allowed, which may support code verification and provenance tracking. Using this package may eliminate a whole class of potential scientific programming mistakes.</p>
<p>Where the R packages <a href="https://cran.r-project.org/package=measurements">measurements</a> and <a href="https://cran.r-project.org/package=NISTunits">NISTunits</a> provide conversion between a fixed number of units, with the help of the udunits library and unit database R package <a href="https://cran.r-project.org/package=units">units</a> allows for arbitrarily complex derived units. By treating units as expressions it can derive, convert and simplify units. In addition, beyond the SI units packaged, <a href="https://cran.r-project.org/package=units">units</a> handles user-defined units not supported by udunits.</p>
<p>Data in <code>units</code> vectors can be stored as columns in <code>data.frame</code> or <code>tbl_df</code> objects, and can be converted to and from <code>difftime</code>. When <code>units</code> objects have associated time and location information, they could be stored in spatial or spatio-temporal objects provided by <a href="https://cran.r-project.org/package=sp">sp</a> or <a href="https://cran.r-project.org/package=spacetime">spacetime</a> <span class="citation">(E. Pebesma 2012)</span> as these store attribute data in <code>data.frame</code> slots, but for instance not in <code>zoo</code> <span class="citation">(Zeileis and Grothendieck 2005)</span> or <code>xts</code> <span class="citation">(Ryan and Ulrich 2014)</span> objects, as these latter two set the class attribute of a vector or matrix.</p>
<p>Despite all standardization efforts, units may still be ambiguous, or subject to interpretation. For instance for the duration of one year <a href="https://cran.r-project.org/package=NISTunits">NISTunits</a> or <a href="https://cran.r-project.org/package=udunits2">udunits2</a> give us an answer that depends on whether we want a common, leap, Gregorian, Julian, tropical or siderial year (<span class="citation">Lang (2006)</span>, see also <code>demo(year)</code>). This illustrates that those who apply unit conversion should be aware of possible pitfalls. Support for calendars in udunits seems not as well developed as in R.</p>
<p>Future work includes extending packages that read external data from formats, databases or interfaces with support for measurement unit information into R, preserving the measurement unit information. Examples would be interfaces to HDF5 (e.g., <a href="https://cran.r-project.org/package=h5">h5</a>, <span class="citation">Annau (2016)</span>), <a href="https://cran.r-project.org/package=RNetCDF">RNetCDF</a> <span class="citation">(Michna and Woods 2016)</span> or <a href="https://cran.r-project.org/package=sos4R">sos4R</a> <span class="citation">(Nüst, Stasch, and Pebesma 2011)</span>. It would be nice to see units of measurements propagate into units of regression coefficient estimates.</p>
</div>
<div id="acknowledgements" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#acknowledgements" class="anchor"> </a></body></html>Acknowledgements</h1>
<p>We acknowledge three anonymous reviewers and the handling editor for their constructive comments, and Thomas Lin Pedersen for implementing the ggplot extensions in package <code>ggforce</code> that automatically add units to default ggplot axis labels.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>References</h1>
<div id="refs" class="references">
<div id="ref-h5">
<p>Annau, Mario. 2016. <em>H5: Interface to the ’HDF5’ Library</em>. <a href="https://CRAN.R-project.org/package=h5" class="uri">https://CRAN.R-project.org/package=h5</a>.</p>
</div>
<div id="ref-measurements">
<p>Birk, Matthew A. 2016. <em>Measurements: Tools for Units of Measurement</em>. <a href="https://CRAN.R-project.org/package=measurements" class="uri">https://CRAN.R-project.org/package=measurements</a>.</p>
</div>
<div id="ref-cobb">
<p>Cobb, George W., and David S. Moore. 1997. “Mathematics, Statistics, and Teaching.” <em>American Mathematical Monthly</em>, 801–23.</p>
</div>
<div id="ref-NISTunits">
<p>Gama, Jose. 2014. <em>NISTunits: Fundamental Physical Constants and Unit Conversions from NIST</em>. <a href="https://CRAN.R-project.org/package=NISTunits" class="uri">https://CRAN.R-project.org/package=NISTunits</a>.</p>
</div>
<div id="ref-lubridate">
<p>Grolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with Lubridate.” <em>Journal of Statistical Software</em> 40 (1): 1–25. doi:<a href="https://doi.org/10.18637/jss.v040.i03">10.18637/jss.v040.i03</a>.</p>
</div>
<div id="ref-udunits2">
<p>Hiebert, James. 2015. <em>Udunits2: Udunits-2 Bindings for R</em>.</p>
</div>
<div id="ref-iliffe">
<p>Iliffe, Jonathan, and Roger Lott. 2008. <em>Datums and Map Projections: For Remote Sensing, GIS and Surveying</em>. CRC Inc.</p>
</div>
<div id="ref-si">
<p>International Bureau of Weights and Measures, Barry N Taylor, and Ambler Thompson. 2001. “The International System of Units (SI).” US Department of Commerce, Technology Administration, National Institute of Standards; Technology.</p>
</div>
<div id="ref-lang">
<p>Lang, K.R. 2006. <em>Astrophysical Formulae Volume II: Space, Time, Matter and Cosmology, 3rd Edition 1999. 2nd Printing</em>. Springer.</p>
</div>
<div id="ref-RNetCDF">
<p>Michna, Pavel, and Milton Woods. 2016. <em>RNetCDF: Interface to NetCDF Datasets</em>. <a href="https://CRAN.R-project.org/package=RNetCDF" class="uri">https://CRAN.R-project.org/package=RNetCDF</a>.</p>
</div>
<div id="ref-sos4R">
<p>Nüst, D., C. Stasch, and E. J. Pebesma. 2011. “Connecting R to the Sensor Web.” In, edited by S. Geertman, W. Reinhardt, and F. Toppen, 227–46. Lecture Notes in Geoinformation and Cartography. Springer.</p>
</div>
<div id="ref-spacetime">
<p>Pebesma, Edzer. 2012. “Spacetime: Spatio-Temporal Data in R.” <em>Journal of Statistical Software</em> 51 (1): 1–30. doi:<a href="https://doi.org/10.18637/jss.v051.i07">10.18637/jss.v051.i07</a>.</p>
</div>
<div id="ref-sp">
<p>Pebesma, Edzer, and Roger Bivand. 2005. “Classes and Methods for Spatial Data in R.” <em>R News</em> 5 (2): 9–13. <a href="http://cran.r-project.org/doc/Rnews/">http://cran.r-project.org/doc/Rnews/</a>.</p>
</div>
<div id="ref-rj">
<p>Pebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. “Measurement Units in R.” <em>The R Journal</em> 8 (2): 486–94. <a href="http://journal.r-project.org/archive/2016-2/pebesma-mailund-hiebert.pdf" class="uri">http://journal.r-project.org/archive/2016-2/pebesma-mailund-hiebert.pdf</a>.</p>
</div>
<div id="ref-ggforce">
<p>Pedersen, Thomas Lin. 2016. <em>Ggforce: Accelerating ’Ggplot2’</em>. <a href="https://CRAN.R-project.org/package=ggforce" class="uri">https://CRAN.R-project.org/package=ggforce</a>.</p>
</div>
<div id="ref-netcdf">
<p>Rew, Russ, and Glenn Davis. 1990. “NetCDF: An Interface for Scientific Data Access.” <em>IEEE Computer Graphics and Applications</em> 10 (4). IEEE: 76–82.</p>
</div>
<div id="ref-xts">
<p>Ryan, Jeffrey A., and Joshua M. Ulrich. 2014. <em>Xts: EXtensible Time Series</em>. <a href="https://CRAN.R-project.org/package=xts" class="uri">https://CRAN.R-project.org/package=xts</a>.</p>
</div>
<div id="ref-ucum">
<p>Schadow, Gunther, and Clement J McDonald. 2009. “The Unified Code for Units of Measure.” <em>Regenstrief Institute and UCUM Organization: Indianapolis, IN, USA</em>.</p>
</div>
<div id="ref-scheider">
<p>Scheider, Simon, Benedikt Gräler, Edzer Pebesma, and Christoph Stasch. 2016. “Modeling Spatiotemporal Information Generation.” <em>International Journal of Geographical Information Science</em> 30 (10): 1980–2008. <a href="http://dx.doi.org/10.1080/13658816.2016.1151520%20">http://dx.doi.org/10.1080/13658816.2016.1151520</a>.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-tibble">
<p>Wickham, Hadley, Romain Francois, and Kirill Müller. 2016. <em>Tibble: Simple Data Frames</em>. <a href="https://CRAN.R-project.org/package=tibble" class="uri">https://CRAN.R-project.org/package=tibble</a>.</p>
</div>
<div id="ref-zoo">
<p>Zeileis, Achim, and Gabor Grothendieck. 2005. “Zoo: S3 Infrastructure for Regular and Irregular Time Series.” <em>Journal of Statistical Software</em> 14 (6): 1–27. doi:<a href="https://doi.org/10.18637/jss.v014.i06">10.18637/jss.v014.i06</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#abstract">Abstract</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#si">SI</a></li>
      <li><a href="#related-work-in-r">Related work in R</a></li>
      <li><a href="#unidatas-udunits-library-and-the-udunits2-r-package">UNIDATA’s udunits library and the <code>udunits2</code> R package</a></li>
      <li><a href="#udunits-versus-the-unified-code-for-units-of-measure-ucum">Udunits versus the Unified Code for Units of Measure (UCUM)</a></li>
      <li><a href="#handling-data-with-units-in-r-the-units-package">Handling data with units in R: the units package</a></li>
      <li><a href="#discussion-and-conclusions">Discussion and conclusions</a></li>
      <li><a href="#acknowledgements">Acknowledgements</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edzer Pebesma, Thomas Mailund.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
